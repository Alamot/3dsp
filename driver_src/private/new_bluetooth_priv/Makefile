#######################################
#
# 3DSP USB card Linux driver Makefile
#
#######################################

#DEFS += -DBT_TESTDRIVER
#DEFS += -DBT_PETER_TEST_WRITE
DEFS += -DBT_FRAG_USED
DEFS += -DBT_PCM_COMPRESS
DEFS += -DBT_AUTO_SEL_PACKET
DEFS += -DBT_SEND_MULTISCO_ONCE
#DEFS += -DBT_DISCARD_ACL_IN_SCO_CONNECTED
DEFS += -DBT_WRITE_COMMAND_INDICATOR_ONLY_LINK_EMPTY
#DEFS += -DBT_INTERFACE_BUS_DRIVER
#DEFS += -DBT_ACCESS_SCRATCH_REG_SAFE
DEFS += -DBT_AFH_ADJUST_MAP_SUPPORT
#DEFS += -DBT_ACCESS_SCRATCH_BY_DMA0
#DEFS += -DBT_RECORD_VOX_TO_FILE
#DEFS += -DBT_USE_INTERNAL_TEST_BDADDR
#DEFS += -DBT_FHS_PACKET_TAKE_WLAN_SPACE
DEFS += -DBT_SCHEDULER_SUPPORT
#DEFS += -DBT_USE_ONE_SLOT_FOR_ACL
#DEFS += -DBT_AUX1_INSTEAD_DH1
#DEFS += -DBT_LOOPBACK_SUPPORT
DEFS += -DBT_RSSI_SUPPORT
DEFS += -DBT_POWER_CONTROL_SUPPORT
#DEFS += -DBT_TESTMODE_SUPPORT
DEFS += -DBT_ROLESWITCH_SUPPORT
DEFS += -DBT_AFH_SUPPORT
DEFS += -DBT_USING_ADD_SCO_COMMAND
#DEFS += -DBT_DISCARD_SPILTH_SCO_IN_BYTES
DEFS += -DBT_USE_NEW_ARCHITECTURE
#DEFS += -DBT_SERIALIZE_DRIVER
#DEFS += -DBT_AUTO_SNIFF
DEFS += -DBT_SNIFF_SUPPORT
DEFS += -DBT_ENHANCED_RATE
DEFS += -DBT_ROLESWITCH_UNALLOWED_WHEN_MULTI_SLAVE
DEFS += -DBT_SUPPROT_RX_FRAG
DEFS += -DBT_MATCH_CLASS_OF_DEVICE
DEFS += -DDSP_REG_WRITE_API
DEFS += -DBT_ENCRYPTION_SUPPORT
#DEFS += -DSERIALIZE_ALL_THREADS
#DEFS += -DBT_EXT_SCO_LINK_SUPPORT
#DEFS += -DBT_LOAD_EEPROM_SUPPORT
#DEFS += -DBT_3DSP_HI_SPEED
DEFS += -DLMP_DEBUG_DUMP
DEFS += -DBT_3DSP_FLUSH_SUPPORT
#DEFS += -DWB_PROXY_FLAG
DEFS += -DHOT_KEY_ENABLE

export DEFS

ifeq ($(shell getconf LONG_BIT),32)
TdspUsbBtLib=3dspusbbtlib.a
else
TdspUsbBtLib=3dspusbbtlib64.a
endif

ifneq ($(KERNELRELEASE),)

EXTRA_CFLAGS := $(DEFS) -Wno-unused-variable -Wno-parentheses -Wno-format -Wnonnull -Wstrict-prototypes

#EXTRA_CFLAGS += -I$(src)/lib/
#EXTRA_CFLAGS += -g
#LD += -S

obj-m := 3dspusbbtpriv.o
3dspusbbtpriv-y := usbbt_entry.o $(TdspUsbBtLib)

else
	KDIR ?= /lib/modules/$(shell uname -r)/build/
#	KDIR ?= /usr/src/kernels/linux9260
all:
	@echo
	@echo DEFS=$(DEFS)
	$(MAKE) -C $(KDIR) M=`pwd` modules
endif

clean:
	-rm *.o *.ko
	-rm Module.*
	-rm *.mod.c
	-rm *.order
